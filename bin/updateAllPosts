#!/usr/bin/env node

require('../models/article.js');

var fs = require('fs');
var config = require('../config.js');
var Article = require('mongoose').model('Article');
var fd = require('../fileDeferrer.js');

fs.readdir('./posts/', function (error, files) {
        if (error) {
            console.error(error);
            return;
        }
        console.log(files);
        var j = 0;
        for (var i = 0; i < files.length; i++) {
            if ((/[\w-_]+\.md$/).test(files[i])) {
                console.log('Updating using file: ', files[i]);
                fd.deferUpdate(files[i], function (fileName) {
                    Article.updatePost('./posts/' + fileName, function (error, slug) {
                        fd.queueNext(function () {
                            process.exit(0);
                        });
                    });
                });
            }
            console.log(files[i]);
        }
        fd.queueNext();
});


